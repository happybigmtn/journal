---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// In production, only show published entries; in dev, show all non-draft entries
const allEntries = await getCollection('journal', ({ data }) =>
  !data.draft && (import.meta.env.DEV || data.published)
);

// Sort reverse chronologically (newest first)
const sortedEntries = allEntries.sort((a, b) =>
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
};
---

<BaseLayout title="Timeline | Journal">
  <h1 class="page-title">Timeline</h1>

  {sortedEntries.length === 0 ? (
    <p class="empty-state">No entries yet.</p>
  ) : (
    <ul class="entry-list">
      {sortedEntries.map(entry => (
        <li>
          <a href={`/${entry.slug}`} class="entry-link">
            <time class="entry-date">{formatDate(new Date(entry.data.date))}</time>
            <span class="entry-title">{entry.data.title}</span>
            {entry.data.mood && <span class="entry-mood">{entry.data.mood}</span>}
          </a>
        </li>
      ))}
    </ul>
  )}
</BaseLayout>

<style>
  .page-title {
    font-family: var(--font-display);
    font-size: var(--text-lg);
    font-weight: 400;
    font-style: italic;
    color: var(--fg-muted);
    margin-bottom: 2rem;
  }

  .empty-state {
    color: var(--fg-muted);
  }

  .entry-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .entry-list li {
    border-bottom: 1px solid var(--border-color);
  }

  .entry-list li:last-child {
    border-bottom: none;
  }

  .entry-link {
    display: flex;
    align-items: baseline;
    gap: 1rem;
    padding: 0.75rem 0;
    text-decoration: none;
    color: var(--fg);
    border: none;
    transition: opacity 100ms;
  }

  .entry-link:hover {
    opacity: 0.7;
  }

  .entry-date {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--accent);
    min-width: 6rem;
  }

  .entry-title {
    flex: 1;
    color: var(--fg-muted);
  }

  .entry-mood {
    font-size: var(--text-sm);
    color: var(--fg-muted);
  }
</style>
