---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const articles = await getCollection('articles');

// Sort by date descending (newest first)
const sortedArticles = articles.sort((a, b) =>
  new Date(b.data.date).getTime() - new Date(a.data.date).getTime()
);

const formatDate = (date: Date) => {
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
};
---

<BaseLayout title="Articles">
  <h1 class="page-title">Articles</h1>
  <p class="page-subtitle">Saved reads worth revisiting</p>

  {sortedArticles.length === 0 ? (
    <p class="empty-state">No articles saved yet.</p>
  ) : (
    <ul class="article-list">
      {sortedArticles.map(article => (
        <li class="article-item">
          <a href={`/articles/${article.slug}`} class="article-link">
            <span class="article-title">{article.data.title}</span>
            <span class="article-meta">
              {article.data.author && <span class="author">{article.data.author}</span>}
              {article.data.source && <span class="source">{article.data.source}</span>}
              <span class="date">{formatDate(article.data.date)}</span>
            </span>
          </a>
          {article.data.tags && article.data.tags.length > 0 && (
            <div class="article-tags">
              {article.data.tags.map(tag => (
                <span class="tag">{tag}</span>
              ))}
            </div>
          )}
        </li>
      ))}
    </ul>
  )}
</BaseLayout>

<style>
  .page-title {
    font-family: var(--font-display);
    font-size: var(--text-lg);
    font-weight: 400;
    font-style: italic;
    color: var(--fg-muted);
    margin-bottom: 0.25rem;
  }

  .page-subtitle {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--fg-muted);
    opacity: 0.7;
    margin-bottom: 2rem;
  }

  .empty-state {
    color: var(--fg-muted);
    font-style: italic;
    padding: 2rem 0;
  }

  .article-list {
    list-style: none;
    padding: 0;
    margin: 0;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .article-item {
    border-bottom: 1px solid var(--border);
    padding-bottom: 1.5rem;
  }

  .article-item:last-child {
    border-bottom: none;
  }

  .article-link {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
    text-decoration: none;
    color: inherit;
  }

  .article-link:hover .article-title {
    color: var(--accent);
  }

  .article-title {
    font-family: var(--font-display);
    font-size: var(--text-base);
    font-style: italic;
    color: var(--fg);
    transition: color 0.2s;
  }

  .article-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--fg-muted);
  }

  .article-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 0.5rem;
  }

  .tag {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    color: var(--fg-muted);
    background: var(--bg-elevated);
    padding: 0.125rem 0.375rem;
  }
</style>
