# Ralph Progress Log
Started: 2025-01-07
Target: Journal Enhancements

## Codebase Patterns

### Astro Site
- Content collection: Use `getCollection('journal')` for entries
- Schema: Defined in `site/src/content/config.ts` with Zod
- CSS variables: Monochrome palette in `:root` of `global.css`
- Entry types: daily, weekly, monthly (add yearly when needed)
- File paths: `journal/YYYY/MM/YYYY-MM-DD.md` for daily entries

### Neovim Lua
- Dates: `os.date("*t")` returns table, `os.time()` for unix timestamp
- Templates: Use `{{PLACEHOLDER}}` syntax for date substitution
- Commands: Create with `nvim_create_user_command`
- Keymaps: Create with `vim.keymap.set`
- Async jobs: Use `vim.fn.jobstart` for non-blocking builds

### Templates
- Frontmatter: YAML between `---` markers
- Required fields: title, date, type
- Optional fields: mood, tags, draft
- Placeholders: {{DATE}}, {{YEAR}}, {{MONTH}}, {{WEEK}}, {{WEEKDAY}}

## Key Files

- site/src/content/config.ts - Zod schema for frontmatter
- site/src/styles/global.css - Monochrome design system
- nvim/journal.lua - All Neovim commands and keymaps
- templates/*.md - Entry templates

---

## 2025-01-07 - Initial Setup

- Created journal project from PRD
- Implemented Astro static site with monochrome design
- Created Neovim integration without plugins
- Set up templates for daily, weekly, monthly entries
- **Learnings:**
  - Astro content collections require explicit schema
  - Neovim autocmd pattern must match exact directory path
  - BufWritePost can trigger builds on save

---

## 2025-01-07 - Code Review

- Ran 4 parallel review agents comparing codebase to plan
- Identified critical issues:
  - Duplicate keymap `<leader>jn` (lines 276, 280)
  - Gray-light color fails WCAG AA (2.85:1 contrast)
  - No date validation bounds
  - Missing EB Garamond font import
- Created prd.json with 15 user stories
- **Learnings:**
  - WCAG AA requires 4.5:1 contrast for normal text
  - Neovim keymaps can silently override each other
  - Always validate user input dates

---

## 2026-01-07 - US-001, US-002, US-003

- US-001: Already resolved - keymaps refactored to use `<leader>jj`, `jw`, `jm` etc.
- US-002: Updated `--gray-light` from #999999 to #525252 (7.14:1 contrast)
- US-003: Added `validate_date()` function with bounds checking
- Files changed: `site/src/styles/global.css`, `nvim/journal.lua`
- **Learnings:**
  - Lua's `os.time()` normalizes invalid dates (Feb 30 â†’ Mar 2), compare to detect errors
  - WCAG AA requires 4.5:1 contrast, AAA requires 7:1; #525252 exceeds both
  - Date validation should use `os.time` + normalization check for leap year handling

---

## 2026-01-07 - Design System Implementation (US-016 through US-030)

- Completed 15 design system stories implementing editorial/magazine aesthetic
- Key changes:
  - Pure monochrome palette (black, white, muted, muted-foreground)
  - Editorial typography (Playfair Display, Source Serif 4, JetBrains Mono)
  - Dramatic type scale (xs through 9xl)
  - Sharp corners everywhere (border-radius: 0)
  - Border weight system (hairline, thin, medium, thick, ultra)
  - Paper texture overlay
  - Instant (100ms) hover transitions
  - Focus states for accessibility
  - Drop caps, oversized dates, inverted hero
  - Pull quote styling for blockquotes
  - Color inversion on hover for archive items
  - Tags as uppercase monospace labels with borders
- **Learnings:**
  - CSS ::before can create texture overlays without affecting interactivity
  - :focus-visible prevents outlines on mouse clicks while preserving keyboard a11y
  - Negative margins can expand clickable areas beyond container
  - CSS custom properties work well for design systems (tokens)

---
