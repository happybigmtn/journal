# Ralph Progress Log
Started: 2025-01-07
Target: Journal Enhancements

## Codebase Patterns

### Astro Site
- Content collection: Use `getCollection('journal')` for entries
- Schema: Defined in `site/src/content/config.ts` with Zod
- CSS variables: Monochrome palette in `:root` of `global.css`
- Entry types: daily, weekly, monthly (add yearly when needed)
- File paths: `journal/YYYY/MM/YYYY-MM-DD.md` for daily entries

### Neovim Lua
- Dates: `os.date("*t")` returns table, `os.time()` for unix timestamp
- Templates: Use `{{PLACEHOLDER}}` syntax for date substitution
- Commands: Create with `nvim_create_user_command`
- Keymaps: Create with `vim.keymap.set`
- Async jobs: Use `vim.fn.jobstart` for non-blocking builds

### Templates
- Frontmatter: YAML between `---` markers
- Required fields: title, date, type
- Optional fields: mood, tags, draft
- Placeholders: {{DATE}}, {{YEAR}}, {{MONTH}}, {{WEEK}}, {{WEEKDAY}}

## Key Files

- site/src/content/config.ts - Zod schema for frontmatter
- site/src/styles/global.css - Monochrome design system
- nvim/journal.lua - All Neovim commands and keymaps
- templates/*.md - Entry templates

---

## 2025-01-07 - Initial Setup

- Created journal project from PRD
- Implemented Astro static site with monochrome design
- Created Neovim integration without plugins
- Set up templates for daily, weekly, monthly entries
- **Learnings:**
  - Astro content collections require explicit schema
  - Neovim autocmd pattern must match exact directory path
  - BufWritePost can trigger builds on save

---

## 2025-01-07 - Code Review

- Ran 4 parallel review agents comparing codebase to plan
- Identified critical issues:
  - Duplicate keymap `<leader>jn` (lines 276, 280)
  - Gray-light color fails WCAG AA (2.85:1 contrast)
  - No date validation bounds
  - Missing EB Garamond font import
- Created prd.json with 15 user stories
- **Learnings:**
  - WCAG AA requires 4.5:1 contrast for normal text
  - Neovim keymaps can silently override each other
  - Always validate user input dates

---

## 2026-01-07 - US-001, US-002, US-003

- US-001: Already resolved - keymaps refactored to use `<leader>jj`, `jw`, `jm` etc.
- US-002: Updated `--gray-light` from #999999 to #525252 (7.14:1 contrast)
- US-003: Added `validate_date()` function with bounds checking
- Files changed: `site/src/styles/global.css`, `nvim/journal.lua`
- **Learnings:**
  - Lua's `os.time()` normalizes invalid dates (Feb 30 ‚Üí Mar 2), compare to detect errors
  - WCAG AA requires 4.5:1 contrast, AAA requires 7:1; #525252 exceeds both
  - Date validation should use `os.time` + normalization check for leap year handling

---

## 2026-01-07 - Design System Implementation (US-016 through US-030)

- Completed 15 design system stories implementing editorial/magazine aesthetic
- Key changes:
  - Pure monochrome palette (black, white, muted, muted-foreground)
  - Editorial typography (Playfair Display, Source Serif 4, JetBrains Mono)
  - Dramatic type scale (xs through 9xl)
  - Sharp corners everywhere (border-radius: 0)
  - Border weight system (hairline, thin, medium, thick, ultra)
  - Paper texture overlay
  - Instant (100ms) hover transitions
  - Focus states for accessibility
  - Drop caps, oversized dates, inverted hero
  - Pull quote styling for blockquotes
  - Color inversion on hover for archive items
  - Tags as uppercase monospace labels with borders
- **Learnings:**
  - CSS ::before can create texture overlays without affecting interactivity
  - :focus-visible prevents outlines on mouse clicks while preserving keyboard a11y
  - Negative margins can expand clickable areas beyond container
  - CSS custom properties work well for design systems (tokens)

---

## 2026-01-07 - Additional Enhancements (US-005, US-031, US-032, US-034)

- US-005: Created /tags index page with alphabetical listing and counts
- US-031: Increased container to 72rem with responsive padding (4rem‚Üí8rem)
- US-032: Responsive typography scaling (headlines reduce on mobile)
- US-034: Added skip link for keyboard accessibility
- **Learnings:**
  - Astro pages can reduce collections to compute aggregates like tag counts
  - Skip links need both position:absolute and z-index for proper layering
  - Responsive design should scale typography, not hide content

---

## 2026-01-07 - US-006 Full-text Search

- Created `/search` route with client-side search functionality
- Built JSON search index at build time containing title, content, tags, mood
- Implemented weighted scoring: title (10) > tags (8) > mood (5) > content (3)
- Added term highlighting using `<mark>` tags with color inversion
- Stored recent searches in localStorage (max 5)
- Files changed: `site/src/pages/search.astro`
- **Learnings:**
  - Static sites can implement search via build-time JSON index + client-side JS
  - `define:vars` in Astro scripts injects server data into client scripts
  - Debounced input (200ms) prevents excessive re-renders during typing
  - `:global(mark)` in scoped CSS targets dynamically injected elements

---

## 2026-01-07 - US-007 Yearly Review Template

- Created `templates/yearly.md` with 10 reflection sections
- Added 'yearly' to content schema type enum
- Updated journal.lua to handle yearly entry type
- Added `:JournalNew year` command and `<leader>jy` keymap
- Files changed: `templates/yearly.md`, `site/src/content/config.ts`, `nvim/journal.lua`
- **Learnings:**
  - Yearly reviews need different prompts than daily (retrospective + forward-looking)
  - Zod enums can be extended by adding values to array
  - Template placeholders like {{YEAR}}+1 don't auto-increment; handled manually in template

---

## 2026-01-07 - US-008 Sleep Tracking

- Added `sleep_hours` optional field to content schema with 0-24 validation
- Added Sleep section to daily template with quality prompts
- Updated entry layout to display sleep alongside mood in meta row
- Added CSS for entry-meta flex layout
- Files changed: `site/src/content/config.ts`, `templates/daily.md`, `site/src/layouts/EntryLayout.astro`, `site/src/styles/global.css`
- **Learnings:**
  - Zod `.min(0).max(24)` provides clean numeric range validation
  - Flex layout with gap works well for optional metadata display
  - Keep frontmatter fields optional when user may not always track them

---

## 2026-01-07 - US-009 Energy Level Tracking

- Added `energy` optional field (1-10 integer) to content schema
- Added Energy Level section with scale prompt in Evening section
- Display energy as visual dot indicator: filled (‚óè) + empty (‚óã)
- Used JS string repeat for dynamic dot generation
- Files changed: `site/src/content/config.ts`, `templates/daily.md`, `site/src/layouts/EntryLayout.astro`, `site/src/styles/global.css`
- **Learnings:**
  - Zod `.int()` ensures whole numbers only
  - String `.repeat(n)` is elegant for generating visual indicators
  - Unicode filled/empty circles (‚óè‚óã) work well for monochrome displays

---

## 2026-01-07 - US-010 Dark Mode Support

- Added `prefers-color-scheme: dark` media query with CSS custom property overrides
- Inverted palette: --black‚Üî--white, --muted‚Üí#1A1A1A, --muted-foreground‚Üí#A3A3A3
- Added neutral gray texture (128,128,128) that works in both modes
- Created fixed toggle button with sun/moon icons (44px touch target)
- Applied theme before render using inline script to prevent flash
- Persisted choice in localStorage
- Files changed: `site/src/styles/global.css`, `site/src/layouts/BaseLayout.astro`
- **Learnings:**
  - `:root:not([data-theme="light"])` respects system preference unless overridden
  - Inline script in `<head>` with `is:inline` runs before render in Astro
  - Monochrome designs invert perfectly - just swap black/white values

---

## 2026-01-07 - US-011 Timeline Visualization

- Created `/timeline` route with vertical chronological view
- Entries displayed as points on 4px black line with alternating left/right layout
- Square timeline points (16x16) with medium border, mood emoji adjacent
- Year and month dropdowns for filtering (client-side JS with `define:vars`)
- Entry count updates dynamically based on filter selection
- Cards show date, type badge, and energy dots (if available)
- Full color inversion on hover (matching archive list pattern)
- Responsive: single column on mobile with timeline line at left edge
- Files changed: `site/src/pages/timeline.astro`
- **Learnings:**
  - Alternating sides achieved with `index % 2` and CSS positioning
  - `dataset` attributes + client-side JS enable filtering without full page reload
  - Timeline points can host adjacent content (mood) via absolute positioning
  - Square timeline points match editorial "sharp corners" design system

---

## 2026-01-07 - US-012 Calendar Heat Map

- Created `/calendar` route with year-at-a-glance 12-month grid
- 4-column responsive layout (3 on tablet, 2 on mobile, 1 on small screens)
- Binary heat map: black fill = entry exists, white = no entry
- Each month shows 7-column day grid with weekday headers (S M T W T F S)
- Entry counts displayed per month and total for year
- Year selector allows switching between years (client-side rendering)
- Days with entries are clickable links to the entry page
- Inverted hover state on entry days (white text on black becomes black on white)
- Files changed: `site/src/pages/calendar.astro`
- **Learnings:**
  - Calendar generation needs `startDayOfWeek` offset for proper alignment
  - `aspect-ratio: 1` keeps day cells square regardless of content
  - Pre-computing all years' data allows instant client-side switching
  - Binary (black/white) heat map is cleaner than gradient for monochrome design

---

## 2026-01-07 - US-013 Export Functionality

- Added `:JournalExport` command with optional date range and format arguments
- Usage: `:JournalExport [start_date] [end_date] [json|markdown]`
- Markdown export: concatenated entries with ## headers, mood metadata, section dividers
- JSON export: structured `{entries: [{date, metadata, content}]}` format
- Simple YAML frontmatter parsing (handles common fields)
- JSON escaping for special characters (\n, \t, ", \\)
- Output file auto-named with timestamp, opens after creation
- Added `<leader>je` keymap for quick export
- Files changed: `nvim/journal.lua`
- **Learnings:**
  - Lua lacks native JSON; manual string building works for simple structures
  - YAML frontmatter parsing via regex handles most common cases
  - `os.time()` comparison enables efficient date range filtering
  - Export is read-only, doesn't modify source files

---

## 2026-01-07 - US-014 Random Past Entry

- Added `:JournalRandom` command to open a random past entry
- Skips entries from current week (calculates week start using `wday`)
- Shows notification with: date, weekday name, and relative time ("3 months ago")
- Relative time adapts: days for <30, months for <365, years otherwise
- Uses `math.randomseed(os.time())` for varied selection
- Added `<leader>jr` keymap
- Files changed: `nvim/journal.lua`
- **Learnings:**
  - Lua's `os.date("*t").wday` returns 1=Sunday, so `wday-1` gives days since Sunday
  - Week boundary calculation needs time normalization to midnight
  - Random rediscovery encourages reflection without explicit search

---

## 2026-01-07 - US-015 Streak Tracking

- Implemented streak calculation in both Lua (Neovim) and TypeScript (Astro)
- Current streak: counts consecutive days from today/yesterday going backwards
- Longest streak: iterates all dates, tracks max consecutive run
- DST tolerance: allows ¬±1 hour variance in "one day" calculation
- Neovim shows streak in startup notification + `:JournalStreak` command
- Site displays streak in hero section with monospace typography
- Only shows longest when greater than current (to avoid redundancy)
- Added `<leader>js` keymap
- Files changed: `nvim/journal.lua`, `site/src/pages/index.astro`, `site/src/styles/global.css`
- **Learnings:**
  - Streak logic must handle "no entry today but yesterday continues streak"
  - Normalizing times to noon prevents timezone/DST edge cases
  - Duplicate implementation (Lua + TS) needed because Neovim and Astro run separately

---

## 2026-01-07 - US-033 Editorial Navigation

- Added site-wide navigation in BaseLayout.astro
- Five links: Archive, Timeline, Calendar, Tags, Search
- Editorial masthead styling: uppercase, tracking-widest, monospace font
- Active page indicated by 4px bottom border (matches design system thick border)
- Full color inversion on hover (100ms transition)
- Active state detection via `Astro.url.pathname` comparison
- Responsive padding matching container breakpoints
- Files changed: `site/src/layouts/BaseLayout.astro`, `site/src/styles/global.css`
- **Learnings:**
  - `class:list` in Astro allows conditional class application
  - `aria-current="page"` improves screen reader navigation context
  - Border-bottom for active state preserves clickable area (vs underline)

---

## 2026-01-07 - US-035 Touch Target Sizing

- Added `@media (pointer: coarse)` block for touch device styling
- All interactive elements get 44px minimum height/width
- Audited elements: nav links, archive items, tags, timeline cards, calendar days, inputs, selects
- Used `min-height: 44px` + `display: inline-flex` + `align-items: center` pattern
- Theme toggle already 44x44 from US-010 implementation
- Documented touch target requirements with CSS comment header
- Files changed: `site/src/styles/global.css`
- **Learnings:**
  - `pointer: coarse` media query targets touch devices more accurately than screen width
  - `min-height` is safer than `height` to avoid squishing content
  - WCAG 2.1 AAA requires 44x44px; AA allows 24x24px (we chose AAA)
  - `inline-flex` + `align-items: center` vertically centers text in larger targets

---

## 2026-01-07 - US-036 GitHub Actions Deployment

- Verified existing `.github/workflows/deploy.yml` meets all acceptance criteria
- Workflow structure: build job ‚Üí deploy job with GitHub Pages environment
- Uses `npm ci` with caching for reproducible, fast builds
- Proper permissions: `contents: read`, `pages: write`, `id-token: write`
- Custom domain `rizz.dad` configured via `site/public/CNAME`
- Concurrency control prevents conflicting deployments
- Files verified: `.github/workflows/deploy.yml`, `site/public/CNAME`, `site/astro.config.mjs`
- **Learnings:**
  - `actions/deploy-pages@v4` is the modern approach (vs. pushing to gh-pages branch)
  - CNAME file in public/ gets copied to dist/ during build for custom domain persistence
  - `npm ci` requires package-lock.json; faster and more deterministic than `npm install`
  - Two-job workflow (build ‚Üí deploy) allows artifact inspection between stages

---

## 2026-01-07 - US-037 On This Day Feature

- Added "On This Day" memory surfacing to EntryLayout.astro
- Queries entries matching current month-day from previous years
- Displays year, "X years ago", mood emoji, and title in grid layout
- Full color inversion hover effect matching design system
- Created dedicated `/on-this-day` page with:
  - Today's memories section (highlighted if entries exist)
  - All memorable dates (only dates with multi-year entries)
  - Grouped by month-day, sorted chronologically
- Added CSS for `.on-this-day`, `.memories-list`, `.memory-item` components
- Files changed: `site/src/layouts/EntryLayout.astro`, `site/src/pages/on-this-day.astro`, `site/src/styles/global.css`
- **Learnings:**
  - `getMonth()` returns 0-11, need to compare raw values not formatted strings
  - Map with month-day key efficiently groups entries across years
  - "Years ago" helper handles singular/plural for better UX
  - Grid layout with `grid-template-columns: auto auto 1fr` creates flexible row structure

---

## 2026-01-07 - US-038 Image/Photo Support

- Enhanced CSS for editorial image styling:
  - Full-width with thin border in `.entry-content img`
  - Figure/figcaption support for captioned images
  - `.full-bleed` class for images extending beyond content width
  - `.image-gallery` grid component for multiple images
  - Grayscale filter maintains monochrome aesthetic
- Created `site/public/journal/assets/` directory structure with YYYY/MM/ pattern
- Added `:JournalImage` command + `<leader>ji` keymap in Neovim
- Command prompts for filename, creates assets directory, inserts markdown
- Files changed: `site/src/styles/global.css`, `nvim/journal.lua`
- **Learnings:**
  - Astro serves `public/` files at root path (e.g., `/journal/assets/...`)
  - `vim.ui.input` provides async input modal in Neovim
  - `gsub("[-_]", " ")` converts filename to readable alt text
  - Negative margins create full-bleed images without breaking container

---

## 2026-01-07 - US-039 Entry Privacy Levels

- Added `published: boolean` field to content schema (default: false)
- Updated all pages to filter: `!data.draft && (import.meta.env.DEV || data.published)`
  - In dev mode: shows all non-draft entries (for preview)
  - In production: only shows entries with `published: true`
- Added `:JournalPublish` command + `<leader>jP` keymap to toggle published status
- Toggle function finds/updates frontmatter `published:` line or inserts if missing
- Added PUBLIC badge in entry meta row (inverted monochrome style)
- Files changed: `site/src/content/config.ts`, `site/src/pages/*.astro`, `site/src/layouts/EntryLayout.astro`, `nvim/journal.lua`, `site/src/styles/global.css`
- **Learnings:**
  - `import.meta.env.DEV` is true during `astro dev`, false during `astro build`
  - getCollection filter runs at build time, so different results in dev vs prod
  - Lua string find/replace in buffer via `nvim_buf_get_lines` + `table.insert` + `nvim_buf_set_lines`
  - Capital keymap `<leader>jP` distinguishes from lowercase `<leader>jp` (publish site)

---

## 2026-01-07 - US-040 RSS Feed

- Installed `@astrojs/rss` package
- Created `/rss.xml` endpoint at `site/src/pages/rss.xml.ts`
- Feed includes only published entries (filters by `!data.draft && data.published`)
- RSS items include: title, pubDate, description, link, categories (tags)
- Added RSS autodiscovery link in BaseLayout.astro head
- Files changed: `site/src/pages/rss.xml.ts`, `site/src/layouts/BaseLayout.astro`, `site/package.json`
- **Learnings:**
  - Astro `.xml.ts` files are server endpoints that generate static XML at build
  - `@astrojs/rss` requires `site` in astro.config.mjs for full URLs
  - RSS 2.0 uses `<pubDate>` in RFC 822 format (handled automatically by rss())
  - Autodiscovery via `<link rel="alternate" type="application/rss+xml">` enables browsers/readers to find feed

---

## 2026-01-07 - US-041 Word Count and Reading Time

- Added word count calculation from `entry.body` raw markdown
- Strips frontmatter, code blocks, and markdown syntax before counting
- Estimates reading time at 200 words per minute (minimum 1 min)
- Displayed in entry metadata row: "X min read" and "X words"
- Uses `toLocaleString()` for number formatting (1,234 vs 1234)
- Files changed: `site/src/layouts/EntryLayout.astro`, `site/src/styles/global.css`
- **Learnings:**
  - Astro content collections expose `entry.body` as raw markdown string
  - Regex chaining removes markdown syntax before word splitting
  - `Math.max(1, ...)` ensures minimum 1 minute reading time
  - Word count varies based on how aggressively syntax is stripped

---

## 2026-01-07 - US-042 Mood Analytics and Visualization

- Created `/insights` page with comprehensive mood analytics
- Emoji-to-score mapping (1-5 scale): üòä=5, üôÇ=4, üòê=3, üòï=2, üòû=1
- Bar charts for mood by day of week and by month
- Mood distribution showing most frequent moods with counts
- Recent trend chart (last 30 entries as horizontal points)
- Overall statistics: entry count and average mood
- Added "Insights" to main navigation
- Files changed: `site/src/pages/insights.astro`, `site/src/layouts/BaseLayout.astro`
- **Learnings:**
  - CSS bar charts: percentage width in container for horizontal bars
  - Emoji detection requires mapping table (no semantic parsing)
  - `getDay()` returns 0=Sunday, useful for weekday analysis
  - Empty state important when no mood data exists

---

## 2026-01-07 - US-043 Habit Tracker Integration

- Added `habitSchema` to content config supporting both boolean and numeric habits
- Boolean habits: `{ name, done }` for yes/no tracking (exercise, meditate)
- Numeric habits: `{ name, value, goal }` for quantifiable habits (water glasses, pages read)
- Updated daily template with commented habit examples showing both formats
- Added habit display to EntryLayout.astro:
  - Boolean habits show ‚úì/‚úó checkmark indicators
  - Numeric habits show progress bars with value/goal text
- CSS components: `.habits-display`, `.habit-list`, `.habit-item`, `.habit-progress-bar`
- Progress bar fills proportionally (capped at 100%) with hover effect
- Files changed: `site/src/content/config.ts`, `templates/daily.md`, `site/src/layouts/EntryLayout.astro`, `site/src/styles/global.css`
- **Learnings:**
  - Zod discriminated unions aren't needed; optional fields handle polymorphic habit types
  - CSS progress bars: width percentage in inner div, clamp to 100% for overflow
  - Commented template examples teach users without cluttering default entries
  - Monochrome progress bars (black on light gray) match editorial aesthetic

---

## 2026-01-07 - US-044 Shareable Entry Cards for Social Media

- Created OG image generation endpoint at `/og/[...slug].png.ts`
- Used `satori` for React‚ÜíSVG and `sharp` for SVG‚ÜíPNG conversion
- Editorial OG card design: 4px black border, large uppercase date, excerpt, mood emoji, site branding
- Loaded JetBrains Mono + Playfair Display fonts from jsDelivr CDN
- Added `og_image` optional field to content schema for custom override images
- Enhanced BaseLayout with full Open Graph and Twitter Card meta tags:
  - `og:type`, `og:url`, `og:title`, `og:description`, `og:image`
  - `twitter:card` (summary_large_image), `twitter:title`, `twitter:description`, `twitter:image`
  - `article:published_time`, `article:tag` for article metadata
- Updated EntryLayout to pass meta props to BaseLayout (excerpt, OG image URL, date, tags)
- Added `:JournalShare` command + `<leader>jS` keymap to copy shareable URL to clipboard
- Files changed: `site/src/pages/og/[...slug].png.ts`, `site/src/content/config.ts`, `site/src/layouts/BaseLayout.astro`, `site/src/layouts/EntryLayout.astro`, `nvim/journal.lua`, `site/package.json`
- **Learnings:**
  - Satori uses React-like VDOM syntax in plain objects: `{ type, props: { style, children } }`
  - Font loading at module top-level runs once per build, not per page
  - OG images must be 1200x630 for optimal display on all platforms
  - Twitter uses `summary_large_image` card type for images (vs `summary` without)
  - Astro's `getStaticPaths` generates PNG endpoints at build time like any other static route

---

## 2026-01-07 - US-045 Import from Day One and Journey

- Created `scripts/import_journal.lua` for importing from popular journaling apps
- Day One format:
  - Parses `Journal.json` from unzipped export
  - Extracts `creationDate` (ISO 8601), `text`, `tags`, `mood`, `photos`
  - Copies photos from `photos/` subdirectory to assets
- Journey format:
  - Scans directory for individual JSON files per entry
  - Uses `date_journal` (milliseconds timestamp), `text`, `tags`, `photos`
  - Strips HTML tags from content for clean markdown
- Common features:
  - Maps dates to YYYY/MM directory structure
  - Skips existing entries (no overwrites)
  - Generates proper frontmatter with source comment
  - Copies media attachments preserving directory structure
- Added `:JournalImport <format> <path>` command with tab completion
- Usage: `:JournalImport dayone ~/Downloads/DayOne-Export/`
- Files changed: `scripts/import_journal.lua`, `nvim/journal.lua`
- **Learnings:**
  - Day One uses ISO 8601 dates; Journey uses Unix timestamps in milliseconds
  - Both apps may include HTML in text content; regex stripping handles common cases
  - Lua lacks native JSON; simple recursive parser works for these structures
  - Preserving original dates is crucial for "On This Day" and timeline features

---

## 2026-01-07 - US-046 PWA Support for Offline Access

- Created web app manifest at `/manifest.json`:
  - App name, description, theme colors (black/white)
  - Icons at 192x192 and 512x512 for different devices
  - `display: standalone` for app-like experience
- Generated PWA icons using Sharp from SVG source:
  - Icon design: black background, white page with lines, pen accent
  - Apple touch icon at 180x180
  - Favicon at 32x32
- Created service worker (`sw.js`) with caching strategies:
  - Static assets: cache first, background fetch for updates
  - HTML pages: network first, cache fallback
  - Dynamic content: network first, cache fallback
  - Version-based cache busting
- Added offline indicator banner:
  - Fixed position at top of viewport
  - Shows "You are offline" when disconnected
  - Uses `navigator.onLine` events for detection
- Added Apple PWA meta tags for iOS home screen installation
- Registered service worker in BaseLayout on page load
- Files changed: `manifest.json`, `sw.js`, `icons/*`, `BaseLayout.astro`, `global.css`, `scripts/generate-icons.mjs`
- **Learnings:**
  - Service workers intercept ALL fetches; must whitelist external origins
  - `skipWaiting()` + `clients.claim()` activates new SW immediately
  - PWA requires icons at specific sizes (192, 512) for manifest
  - `apple-mobile-web-app-capable` enables iOS home screen mode

---

## 2026-01-07 - US-047 Quick Entry Mode for Micro-journaling

- Added `quick_entry()` function for rapid note capture
- Uses `vim.ui.input` for inline note prompt (no buffer switching)
- Timestamped format: `**HH:MM** ‚Äî note content`
- Behavior:
  - If today's entry exists: appends timestamped note to end of file
  - If no entry: creates minimal file with frontmatter + "Quick Notes" section
- Minimal frontmatter: title, date, type, tags, draft, published (no prompts)
- Auto-reloads buffer if the entry file is already open
- Added `:JournalQuick` command and `<leader>jq` keymap
- Files changed: `nvim/journal.lua`
- **Learnings:**
  - `vim.ui.input` is async; callback pattern required for file operations
  - `io.open(path, "a")` appends without reading entire file
  - `vim.fn.bufnr()` returns -1 if file not in buffer list
  - Minimal friction: no template, no buffer switch, just capture and go

---

## 2026-01-07 - US-048 Entry Templates Beyond Daily

- Created three new specialized templates:
  - `templates/project.md`: Goals, progress log, blockers, next steps, retrospective
  - `templates/book.md`: Author, rating, quotes, chapter notes, reflections
  - `templates/travel.md`: Location, daily log, highlights, photos, budget, practical notes
- Extended content schema with type-specific fields:
  - Project: `project_status` (active/paused/completed/archived)
  - Book: `author`, `rating` (1-5), `pages_read`, `total_pages`, `status` (reading/finished/abandoned/want-to-read)
  - Travel: `location`, `trip_start`, `trip_end`
- Updated `fill_template()` to accept `extra_vars` for type-specific placeholders
  - `{{PROJECT_NAME}}`, `{{BOOK_TITLE}}`, `{{DESTINATION}}` replaced dynamically
- Entry type handling with vim.ui.input prompts for name/title/destination
- Subdirectory storage: `YYYY/projects/`, `YYYY/books/`, `YYYY/travel/`
- Slugified filenames: "My Cool Project" ‚Üí `my-cool-project.md`
- Updated :JournalNew command completion to include project, book, travel
- Added keymaps: `<leader>jnp` (project), `<leader>jnb` (book), `<leader>jnt` (travel)
- Files changed: `templates/project.md`, `templates/book.md`, `templates/travel.md`, `site/src/content/config.ts`, `nvim/journal.lua`
- **Learnings:**
  - Lua gsub chaining (`gsub("[^%w]+", "-"):gsub("^-", ""):gsub("-$", "")`) creates clean slugs
  - Extra template vars passed as third argument to fill_template enables type polymorphism
  - Nested keymaps (`jn` prefix) group related actions without conflicting
  - vim.ui.input callback recursively calls journal_new with populated args

---

## 2026-01-07 - US-049 Automatic Backup to Cloud Storage

- Created `scripts/backup_journal.lua` - comprehensive backup system:
  - Creates timestamped tar.gz archives of journal directory
  - SHA256 checksum calculation and verification
  - GPG encryption (symmetric with passphrase or asymmetric with recipient key)
  - Retention policy: keeps last 30 backups by default
  - Manifest file tracks all backups with timestamps and sizes
- Cloud storage support via rclone:
  - Configure remotes with `rclone config`
  - Supports S3, Backblaze B2, Google Drive, Dropbox, etc.
  - Example targets: `local_backup`, `s3`, `b2`
- Commands and CLI:
  - Direct: `lua backup_journal.lua backup [--target <t>] [--encrypt]`
  - Neovim: `:JournalBackup [target] [--encrypt]`
  - List backups: `:JournalBackupList` (shows in floating window)
  - Keymap: `<leader>jB`
- Created `scripts/setup_backup_schedule.sh` for cron setup:
  - Interactive setup at 2 AM daily
  - Logs to `~/.journal-backups/logs/backup.log`
- Integration with Neovim:
  - `M.backup(target, encrypt)` runs async via jobstart
  - `M.list_backups()` shows results in centered floating window
- Files changed: `scripts/backup_journal.lua`, `scripts/setup_backup_schedule.sh`, `nvim/journal.lua`
- **Learnings:**
  - `debug.getinfo(1, "S").source:sub(2)` gets script path but needs absolute conversion
  - `io.popen("pwd")` in Lua gets current working directory
  - GPG symmetric encryption: `gpg --batch -c` vs asymmetric `gpg -e -r <recipient>`
  - Cron scheduling: `0 2 * * *` = daily at 2 AM
  - Neovim floating windows: `nvim_open_win` with relative="editor"

---

## 2026-01-07 - US-050 Yearly Wrapped Summary

- Created `/wrapped/[year]` dynamic page with Spotify Wrapped-style summary:
  - Statistics: total entries, words written, avg words/entry, longest streak
  - Most productive month and day of week (highlighted cards)
  - Mood breakdown with bar chart visualization
  - Top 10 tags cloud (sized by frequency)
  - Monthly activity bar chart (12 months)
  - Wellness averages (sleep hours, energy level)
  - Entry type breakdown (daily, weekly, project, etc.)
- Share functionality:
  - Inverted share card with key stats
  - "Copy Summary" button generates text for social sharing
  - Summary includes emojis for engagement
- Navigation:
  - Previous/next year links
  - Back to calendar link
  - getStaticPaths generates pages for all years with entries
- Added `:JournalWrapped [year]` command in Neovim:
  - Opens wrapped page in default browser
  - Tab completion for recent 5 years
  - Uses xdg-open (Linux) or open (Mac)
- Files changed: `site/src/pages/wrapped/[year].astro`, `site/src/pages/wrapped/index.astro`, `nvim/journal.lua`
- **Learnings:**
  - Astro dynamic routes: `[year].astro` + `getStaticPaths()` generates pages per year
  - CSS custom properties via `style` attribute: `--size: ${calculated}` enables dynamic sizing
  - Streak calculation: track consecutive dates, reset on gap > 1 day
  - Date math: `getDay()` returns 0-6 (Sunday-Saturday)

---

## 2026-01-07 - US-051 People Mentions and Relationship Tracking

- Created `/people` index page:
  - Lists all @mentioned people from journal entries
  - Shows mention count, first/last seen dates
  - Displays context snippet (sentence containing mention)
  - Expandable "Recent mentions" list per person
  - Reconnect hint (üëã) if >30 days since last mention
- Created `/people/[name]` individual person pages:
  - Timeline of all entries mentioning person
  - Context snippets from each mention
  - Monthly mention frequency bar chart
  - Reconnect banner for inactive relationships
- Added `connections` field to schema:
  - Array of strings: `connections: ["John", "Sarah"]`
  - Alternative to inline @mentions for structured tracking
  - Updated daily template with commented example
- @mention parsing:
  - Regex: `/@(\w+)/g` extracts mentions
  - Case-insensitive matching
  - Deduplicates per entry
- Files changed: `site/src/pages/people/index.astro`, `site/src/pages/people/[name].astro`, `site/src/content/config.ts`, `templates/daily.md`
- **Learnings:**
  - Astro requires function definitions inside `getStaticPaths()` for static path generation
  - Duplicate function definition needed: once in `getStaticPaths`, once in main script context
  - `<details><summary>` HTML5 collapsible sections work well for optional content
  - Context extraction via sentence-boundary regex: `[^.!?]*@name[^.!?]*[.!?]`

---
